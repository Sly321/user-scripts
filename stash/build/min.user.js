// ==UserScript==
// @name         Stash Linker
// @namespace    https://github.com/Sly321/
// @version      0.2.7
// @description  You can click on import links to go the file.
// @author       Sven Liebig
// @match        http://stash.schuetze.infra/projects/*.java
// @require		 https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js
// @updateURL    https://raw.githubusercontent.com/Sly321/user-scripts/master/stash/build/min.user.js
// ==/UserScript==
function addGlobalStyle(e){var t,n;t=document.querySelector("head"),t&&(n=document.createElement("style"),n.type="text/css",n.innerHTML=e,t.appendChild(n))}function isSrcImport(e){var t=/senbjw|isbj|eud|schule|verwalt_berlin/g,n=/javax.faces|javax.persistence|java.util|javax.annotation|java.io|java.beans|org.springframework/g;return!(!e.match(t)&&!e.match(n))}$(document).ready(function(){addGlobalStyle(".import-row { background: #f0f0f0; } .import-row:hover { text-decoration: underline; color: blue; cursor: pointer; } ")});var getLinkFromImportElement,openUrlInNewTab,getHtmlLink,replaceJavaWithHtml,buildDocLink,getJavaxDocLink,getJavaxAnnotationDocLink,getJavaUtilDocLink,getJavaIoDocLink,getJavaBeanDocLink,handleSchultraegerportal,handleEudSchule,handleThirdpartyImport,navigateTo,getAllImportsAndSetClassName,getSpringDocLink,JAVA_ORACLE_API="https://docs.oracle.com/javaee/7/api/",JAVA_ORACLE_DOCS="https://docs.oracle.com/javase/7/docs/api/",SPRING_DOC="http://docs.spring.io/spring-framework/docs/2.5.x/api/";navigateTo=function(e){e+=".java";var t=window.location.pathname.split("/"),n=t[4];switch(n){case"eud-schule":return handleEudSchule(t,e);case"schultraegerportal":return handleSchultraegerportal(t,e);default:return handleThirdpartyImport(t,e)}},handleSchultraegerportal=function(e,t){var n=/schule\/service\//g;if(t.match(!1));else{if(!t.match(n))return handleThirdpartyImport(t);console.log("schultraegerportal-services"),e[6]="schultraegerportal-services"}var a=e.slice(0,e.indexOf("java")+1);return window.location.pathname=a.join("/")+"/"+t,!0},handleEudSchule=function(e,t){var n=/stp\/shared\/schule/g,a=/schule\/web\/controller|schule\/web\/converter|schule\/web\/filter|schule\/web\/job|schule\/web\/servlet|schule\/web\/table|schule\/web\/user|schule\/web\/validator/g,r=/schule\/converter\/|schule\/dto\/|schule\/enums\/|schule\/model\/|schule\/shared\/|schule\/util\//g,o=/schule\/service\//g;if(t.match(n))console.log("stp-shared-schule link"),e[4]="stp-shared-schule",e.splice(6,1);else if(t.match(a))console.log("webapp link"),e[6]="eud-schule-webapp";else if(t.match(r))console.log("model link"),e[6]="eud-schule-model";else{if(!t.match(o))return handleThirdpartyImport(t);console.log("eud-schule-services"),e[6]="eud-schule-services"}var l=e.slice(0,e.indexOf("java")+1);return window.location.pathname=l.join("/")+"/"+t,!0},handleThirdpartyImport=function(e){var t=/javax\/faces\//g,n=/javax\/annotation\/|javax\/persistance\//g,a=/java\/util\//g,r=/java\/io\//g,o=/java\/beans\//g,l=/org\/springframework\//g,c="https://www.google.de/search?q=";return e.match(t)?c=getJavaxDocLink(e):e.match(a)?c=getJavaUtilDocLink(e):e.match(n)?c=getJavaxAnnotationDocLink(e):e.match(r)?c=getJavaIoDocLink(e):e.match(o)?c=getJavaBeanDocLink(e):e.match(l)?c=getSpringDocLink(e):c+=e,openUrlInNewTab(c)},getJavaxDocLink=function(e){return buildDocLink(JAVA_ORACLE_API,e,3)},getJavaxAnnotationDocLink=function(e){return buildDocLink(JAVA_ORACLE_API,e,2)},getJavaUtilDocLink=function(e){return buildDocLink(JAVA_ORACLE_DOCS,e,2)},getJavaIoDocLink=function(e){return buildDocLink(JAVA_ORACLE_DOCS,e,2)},getJavaBeanDocLink=function(e){return buildDocLink(JAVA_ORACLE_DOCS,e,2)},getSpringDocLink=function(e){return buildDocLink(SPRING_DOC,e)},buildDocLink=function(e,t,n){return e+getHtmlLink(replaceJavaWithHtml(t),n)},replaceJavaWithHtml=function(e){e=e.split("/");var t=e.length-1;return e[t]=e[t].replace(".java",".html"),e},getHtmlLink=function(e,t){return void 0===t&&(t=e.length-1),e.slice(0,t).join("/")+"/"+e.slice(t,e.length).join(".")},openUrlInNewTab=function(e){var t=window.open(e,"_blank");return t.focus(),!0},getAllImportsAndSetClassName=function(){var e=document.querySelectorAll(".cm-keyword");return Array.prototype.filter.call(e,function(e){var t=getLinkFromImportElement(e.parentElement);if("import"===e.innerHTML&&isSrcImport(t))return e}).map(function(e){return e.parentElement.classList.add("import-row"),e.parentElement.onclick=function(e){navigateTo(getLinkFromImportElement(e.target))},e.parentElement})},getLinkFromImportElement=function(e){return null===e.querySelector(".cm-variable")&&(e=e.parentElement),Array.prototype.map.call(e.querySelectorAll(".cm-variable"),function(e){return e.innerHTML}).join("/")},$(document).ready(function(){getAllImportsAndSetClassName()});